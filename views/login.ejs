<html>

    <%- include("head.ejs") -%> 



    <body class="NoScrollBar" style="background-color: rgb(40, 44, 47);">


        <!-- 
            Website by  
                Pozm#4351 ~ 690944032355909662
                Pozm#6946 ~ 288062966803333120
        -->
        <div class="bg"></div>


        <%- include("nav.ejs") -%> 


        <div class = 'box welcomingBox loginBox'>


            <h1 class="title is-1" style="color: rgb(228, 228, 228);text-align: center;">Sign in</h1>
            <div style="margin-top: 20px;">
                <form action="" method="POST" style="position: relative; display: grid;">
                
                    <input type="email" id='un' class="input tb no-outline sutb" name="username" placeholder="Username or Email">
                    <input type="password" id='pw' class="input tb no-outline sutb" name="password" placeholder="Password">
                    <input type="button" id='sub' class="button" value="Okay!">


                </form>
                <a href="/signup">Don't have an account? Make one now!</a>
                <p id='message' style="color: rgb(228, 228, 228); text-align: center;"></p>
            </div>

        </div>

        <% if (signedInto)  {%>

            <%- '<script>window.location.replace(\'/\')</script>' -%>

        <%}%>


        <script>
            let sub=document.getElementById('sub')
            let m =document.getElementById('message')

            sub.addEventListener('click', () =>{

                let un =$('#un')
                let pw =$('#pw')

                let data ={
                    'username':un.val(),
                    'password':pw.val()
                }
                console.log(data)
                $.ajax({
                    url:'/api/LogintoAccount',
                    data:data, 
                    success:(res,t,r) => {

                        let data = JSON.parse(res)
                        console.log(data)
                        console.log(r)
                        m.innerText = `${data.error? 'Error: '+ data.message : 'Successful'}`
                        if (! data.error) setTimeout(()=>window.location.replace('/'))
                    },
                    method:'post',
                    error:(crap,res) => {

                        console.log(crap,res)
                        let data = JSON.parse(crap.responseText)
                        console.log(data)
                        m.innerText = `${data.error? 'Error: '+ data.message : 'Successful'}`
                    }
                })
            })

        </script>

    </body>


</html>